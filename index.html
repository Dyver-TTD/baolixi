<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√¨ X√¨ T·∫øt 2026</title>
    <style>
        :root { --red: #d32f2f; --gold: #ffd700; --blue: #3b71ca; }
        body { font-family: 'Arial', sans-serif; background: #fffde7; color: var(--red); text-align: center; padding: 10px; margin: 0; }
        
        /* Input section */
        .input-section { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 600px; margin: 20px auto; }
        .envelope-input { display: inline-block; margin: 5px; }
        input[type="text"] { width: 110px; padding: 8px; border: 2px solid var(--red); border-radius: 5px; text-align: center; font-weight: bold; }
        
        button { background: var(--red); color: white; padding: 12px 20px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 5px; }
        button.secondary { background: #fbc02d; color: #333; }
        button.reset-btn { background: #4caf50; }

        /* Envelopes Grid */
        #envelopes { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
        .envelope { 
            width: 130px; height: 180px; background: linear-gradient(145deg, #e53935, #b71c1c);
            border: 3px solid var(--gold); border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 3.5em;
            transition: 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .envelope.opened { opacity: 0.4; transform: scale(0.9); filter: grayscale(1); }

        /* Popup Box (Gi·ªëng m·∫´u b·∫°n g·ª≠i) */
        #popup-box {
            display: none; position: fixed; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); width: 90%; max-width: 450px; 
            background: white; border-radius: 8px; 
            box-shadow: 0 0 100px rgba(0,0,0,0.3); z-index: 1001;
            overflow: hidden; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        .popup-header { background: var(--blue); color: white; padding: 12px 20px; font-size: 1.1em; font-weight: bold; text-align: left; }
        .popup-body { padding: 45px 20px; font-size: 2.8em; color: #333; font-weight: bold; }
        .popup-footer { padding: 12px 15px; text-align: right; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        
        /* N√∫t trong popup */
        .btn-action { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-size: 1em; font-weight: bold; }
        .btn-refresh { background: #4caf50; color: white; } /* M√†u xanh l√° cho L√†m m·ªõi */
        .btn-close-pop { background: #f5f5f5; color: #333; }
        .btn-action:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <h1>üßß L√å X√å MAY M·∫ÆN üßß</h1>

    <div class="input-section" id="setup-ui">
        <p>Nh·∫≠p s·ªë ti·ªÅn cho t·ªëi ƒëa 10 bao:</p>
        <div id="inputs"></div>
        <div class="controls">
            <button onclick="play()">üßß B·∫Øt ƒê·∫ßu</button>
            <button class="secondary" onclick="clearAll()">X√≥a H·∫øt</button>
        </div>
    </div>

    <div id="result-ui" style="display:none">
        <h2 id="status-msg">H√£y ch·ªçn m·ªôt bao l√¨ x√¨!</h2>
        <div id="envelopes"></div>
        <div class="controls" style="margin-top:30px">
            <button class="reset-btn" onclick="shuffleAgain()">üîÑ L√†m M·ªõi To√†n B·ªô</button>
            <button class="secondary" onclick="backToSetup()">‚¨ÖÔ∏è S·ª≠a S·ªë Ti·ªÅn</button>
        </div>
    </div>

    <div id="popup-box">
        <div class="popup-header">Ch√∫c m·ª´ng nƒÉm m·ªõi!</div>
        <div class="popup-body" id="pop-amount">0 ƒë</div>
        <div class="popup-footer">
            <button class="btn-action btn-refresh" onclick="shuffleAgain()">L√†m m·ªõi</button>
            <button class="btn-action btn-close-pop" onclick="closePopup()">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        let currentAmounts = [];

        function createInputs() {
            const container = document.getElementById('inputs');
            for (let i = 1; i <= 10; i++) {
                const div = document.createElement('div');
                div.className = 'envelope-input';
                div.innerHTML = `<input type="text" id="b${i}" placeholder="Bao ${i}" onkeyup="formatCurrency(this)">`;
                container.appendChild(div);
            }
        }

        function formatCurrency(input) {
            let val = input.value.replace(/\D/g, "");
            if(val) input.value = Number(val).toLocaleString('vi-VN');
        }

        function play() {
            currentAmounts = [];
            for (let i = 1; i <= 10; i++) {
                const val = document.getElementById(`b${i}`).value.replace(/\./g, '');
                if (val !== '') currentAmounts.push(val);
            }
            if (currentAmounts.length === 0) return alert("Vui l√≤ng nh·∫≠p ti·ªÅn!");

            localStorage.setItem("lixi_final_v3", JSON.stringify(
                Array.from({length: 10}, (_, i) => document.getElementById(`b${i+1}`).value)
            ));

            shuffleAndShow();
            document.getElementById('setup-ui').style.display = 'none';
            document.getElementById('result-ui').style.display = 'block';
        }

        function shuffleAndShow() {
            let tempArray = [...currentAmounts];
            for (let i = tempArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [tempArray[i], tempArray[j]] = [tempArray[j], tempArray[i]];
            }

            const container = document.getElementById('envelopes');
            container.innerHTML = '';
            
            tempArray.forEach(amt => {
                const card = document.createElement('div');
                card.className = 'envelope';
                card.innerHTML = 'üßß';
                card.onclick = function() { 
                    if(this.classList.contains('opened')) return;
                    showPopup(amt);
                    this.classList.add('opened');
                };
                container.appendChild(card);
            });
        }

        function showPopup(amount) {
            document.getElementById('pop-amount').innerText = Number(amount).toLocaleString('vi-VN') + " K";
            document.getElementById('popup-box').style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup-box').style.display = 'none';
        }

        // H√†m L√†m m·ªõi: ƒê√≥ng popup v√† x√°o tr·ªôn l·∫°i lu√¥n
        function shuffleAgain() {
            closePopup();
            shuffleAndShow();
            document.getElementById('status-msg').innerText = "ƒê√£ x√°o tr·ªôn! Ch·ªçn l·∫°i ƒëi n√†o!";
            setTimeout(() => { document.getElementById('status-msg').innerText = "H√£y ch·ªçn m·ªôt bao l√¨ x√¨!"; }, 2000);
        }

        function backToSetup() {
            closePopup();
            document.getElementById('setup-ui').style.display = 'block';
            document.getElementById('result-ui').style.display = 'none';
        }

        function clearAll() {
            if(confirm("X√≥a h·∫øt ti·ªÅn ƒë√£ nh·∫≠p?")) {
                for (let i = 1; i <= 10; i++) document.getElementById(`b${i}`).value = '';
                localStorage.removeItem("lixi_final_v3");
            }
        }

        window.onload = () => {
            createInputs();
            const saved = localStorage.getItem("lixi_final_v3");
            if (saved) {
                const arr = JSON.parse(saved);
                arr.forEach((v, i) => { if(document.getElementById(`b${i+1}`)) document.getElementById(`b${i+1}`).value = v; });
            }
        };
    </script>
</body>

</html>
